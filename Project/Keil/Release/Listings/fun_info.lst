C51 COMPILER V9.60.7.0   FUN_INFO                                                          08/06/2025 17:46:20 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE FUN_INFO
OBJECT MODULE PLACED IN .\Release\Objects\fun_info.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\User\fun_info.c LARGE OPTIMIZE(9,SIZE) BROWSE ORDER INTVECTOR(0X00
                    -0C) INCDIR(..\..\Libraries\Include;..\..\User;..\..\User\lib;..\..\Hardware) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(.\Rele
                    -ase\Listings\fun_info.lst) OBJECT(.\Release\Objects\fun_info.obj)

line level    source

   1          #include "fun_info.h"
   2          #include <string.h> // memset()
   3          
   4          volatile fun_info_t fun_info; // å­˜æ”¾æ‰€æœ‰åŠŸèƒ½çŠ¶æ€çš„ç»“æ„ä½“å˜é‡
   5          
   6          // åˆå§‹åŒ–å­˜æ”¾æ‰€æœ‰ä¿¡æ¯çš„ç»“æ„ä½“å˜é‡
   7          void fun_info_init(void)
   8          {
   9   1          u8 page_id;
  10   1          // memset(&fun_info, 0, sizeof(fun_info));
  11   1      
  12   1          // flash_read(0x00, (u8 *)&fun_info.save_info, sizeof(fun_info.save_info));
  13   1      
  14   1          eeprom_menu_init();
  15   1      
  16   1          
  17   1      
  18   1          page_id = eeprom_menu_prev.cur_write_page_id;
  19   1      
  20   1          // æ ¹æ®ä»ç›®å½•è¯»å–åˆ°çš„é¡µé¢idï¼Œæ‰¾åˆ°å¯¹åº”çš„æ•°æ®
  21   1          eeprom_24cxx_read(page_id, (u8 *)&eeprom_saveinfo, sizeof(eeprom_saveinfo_t));
  22   1          if (eeprom_saveinfo.is_data_valid == EEPROM_DATA_VALID_VAL)
  23   1          {
  24   2              fun_info.save_info.total_mileage = eeprom_saveinfo.total_mileage;
  25   2              fun_info.save_info.subtotal_mileage = eeprom_saveinfo.subtotal_mileage;
  26   2              fun_info.save_info.subtotal_mileage_2 = eeprom_saveinfo.subtotal_mileage_2;
  27   2          }
  28   1          else
  29   1          {
  30   2              // å¦‚æœå¯¹åº”çš„é¡µé¢çš„æ•°æ®æ— æ•ˆï¼Œæ‰¾åˆ°å®ƒåŒä¸€ç»„çš„å¦ä¸€ä¸ªé¡µé¢ï¼Œçœ‹çœ‹å¦ä¸€ä¸ªé¡
             -µé¢çš„æ•°æ®æ˜¯å¦æœ‰æ•ˆ
  31   2      
  32   2              if (page_id % 2 == 0)
  33   2              {
  34   3                  /*
  35   3                      å¦‚æœæ˜¯å¶æ•°é¡µé¢id
  36   3                      å¾—åˆ°çš„å¶æ•°ï¼Œä½œä¸ºåŒä¸€ç»„é¡µé¢çš„ç¬¬ä¸€ä¸ªé¡µé¢ prev
  37   3                      å¾—åˆ°çš„å¶æ•° + 1ï¼Œä½œä¸ºåŒä¸€ç»„é¡µé¢çš„ç¬¬äºŒä¸ªé¡µé¢ next
  38   3                  */
  39   3                  page_id += 1;
  40   3              }
  41   2              else
  42   2              {
  43   3                  /*
  44   3                      å¦‚æœæ˜¯å¥‡æ•°é¡µé¢idï¼Œ
  45   3                      å¾—åˆ°çš„å¥‡æ•° - 1ï¼Œä½œä¸ºåŒä¸€ç»„é¡µé¢çš„ç¬¬ä¸€ä¸ªé¡µé¢ prev
  46   3                      å¾—åˆ°çš„å¥‡æ•°ï¼Œä½œä¸ºåŒä¸€ç»„é¡µé¢çš„ç¬¬äºŒä¸ªé¡µé¢ next
  47   3                  */
  48   3                  page_id -= 1;
  49   3              }
  50   2      
  51   2              eeprom_24cxx_read(page_id, (u8 *)&eeprom_saveinfo, sizeof(eeprom_saveinfo_t));
  52   2              if (eeprom_saveinfo.is_data_valid == EEPROM_DATA_VALID_VAL)
C51 COMPILER V9.60.7.0   FUN_INFO                                                          08/06/2025 17:46:20 PAGE 2   

  53   2              {
  54   3                  // å¦‚æœè¯¥é¡µé¢çš„æ•°æ®æœ‰æ•ˆï¼Œå°†æ•°æ®è¯»å‡º
  55   3                  fun_info.save_info.total_mileage = eeprom_saveinfo.total_mileage;
  56   3                  fun_info.save_info.subtotal_mileage = eeprom_saveinfo.subtotal_mileage;
  57   3                  fun_info.save_info.subtotal_mileage_2 = eeprom_saveinfo.subtotal_mileage_2;
  58   3              }
  59   2              else
  60   2              {
  61   3                  // å¦‚æœé¡µé¢çš„æ•°æ®æ— æ•ˆï¼Œè¯´æ˜eepromä¸­è¿˜æ²¡æœ‰å­˜æ”¾æ•°æ®
  62   3                  fun_info.save_info.total_mileage = 0;
  63   3                  fun_info.save_info.subtotal_mileage = 0;
  64   3                  fun_info.save_info.subtotal_mileage_2 = 0;
  65   3              }
  66   2          }
  67   1      }
  68          
  69          // ä¿å­˜ å­˜æ”¾äº†æ‰€æœ‰ä¿¡æ¯çš„ç»“æ„ä½“å˜é‡ï¼Œå†™å…¥flashä¸­
  70          void fun_info_save(void)
  71          {
  72   1          // flash_erase_sector(0x00);
  73   1          // flash_write(0x00, (u8 *)&fun_info.save_info, sizeof(fun_info.save_info));
  74   1      
  75   1          eeprom_data_save();
  76   1      
  77   1          printf("eeprom save\n");
  78   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    156    ----
   CONSTANT SIZE    =     13    ----
   XDATA SIZE       =     36       1
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
