C51 COMPILER V9.60.7.0   FUN_INFO                                                          08/15/2025 17:30:45 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE FUN_INFO
OBJECT MODULE PLACED IN .\Release\Objects\fun_info.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\User\fun_info.c LARGE OPTIMIZE(9,SIZE) BROWSE ORDER INTVECTOR(0X00
                    -0C) INCDIR(..\..\Libraries\Include;..\..\User;..\..\User\lib;..\..\Hardware) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(.\Rele
                    -ase\Listings\fun_info.lst) OBJECT(.\Release\Objects\fun_info.obj)

line level    source

   1          #include "fun_info.h"
   2          #include <string.h> // memset()
   3          
   4          volatile fun_info_t fun_info; // å­˜æ”¾æ‰€æœ‰åŠŸèƒ½çŠ¶æ€çš„ç»“æ„ä½“å˜é‡
   5          
   6          // åˆå§‹åŒ–å­˜æ”¾æ‰€æœ‰ä¿¡æ¯çš„ç»“æ„ä½“å˜é‡
   7          void fun_info_init(void)
   8          {
   9   1          u8 page_id;
  10   1          u32 temp_total_mileage; // ä¸´æ—¶å­˜æ”¾ä»eepromè¯»å‡ºçš„æ€»é‡Œç¨‹æ•°æ®
  11   1      
  12   1          /* å…¨å±€å˜é‡ï¼Œä¸Šç”µåº”è¯¥é»˜è®¤ä¸º0 */
  13   1          // fun_info.save_info.total_mileage = 0;
  14   1          // fun_info.save_info.subtotal_mileage = 0;
  15   1          // fun_info.save_info.subtotal_mileage_2 = 0;
  16   1      
  17   1          eeprom_menu_init();
  18   1          page_id = eeprom_menu_prev.cur_write_page_id; // è·å–ç›®å½•çš„id
  19   1      
  20   1          /*
  21   1              åº”è¯¥å°†åŒä¸€ç»„çš„æ•°æ®éƒ½è¯»å‡ºæ¥ï¼Œæ¯”è¾ƒæ€»é‡Œç¨‹çš„å¤§å°ï¼Œä»¥è¾ƒå¤§çš„ä¸ºæœ€æ–°çš„æ•°æ
             -®ã€‚
  22   1              è¾ƒå°çš„å¯èƒ½æ˜¯å› ä¸ºå†™å…¥eepromæ—¶çªç„¶æ‰ç”µï¼Œä¸­æ–­äº†å†™å…¥
  23   1          */
  24   1          // æ ¹æ®ä»ç›®å½•è¯»å–åˆ°çš„é¡µé¢idï¼Œæ‰¾åˆ°å¯¹åº”çš„æ•°æ®
  25   1          eeprom_24cxx_read(page_id, (u8 *)&eeprom_saveinfo, sizeof(eeprom_saveinfo_t));
  26   1          if (eeprom_saveinfo.is_data_valid == EEPROM_DATA_VALID_VAL)
  27   1          {
  28   2              fun_info.save_info.total_mileage = eeprom_saveinfo.total_mileage;
  29   2              fun_info.save_info.subtotal_mileage = eeprom_saveinfo.subtotal_mileage;
  30   2              fun_info.save_info.subtotal_mileage_2 = eeprom_saveinfo.subtotal_mileage_2;
  31   2      
  32   2              temp_total_mileage = fun_info.save_info.total_mileage;
  33   2          }
  34   1      
  35   1          // æ‰¾åˆ°å®ƒåŒä¸€ç»„çš„å¦ä¸€ä¸ªé¡µé¢ï¼Œçœ‹çœ‹å¦ä¸€ä¸ªé¡µé¢çš„æ•°æ®æ˜¯å¦æœ‰æ•ˆ
  36   1          if (page_id % 2 == 0)
  37   1          {
  38   2              /*
  39   2                  å¦‚æœæ˜¯å¶æ•°é¡µé¢id
  40   2                  å¾—åˆ°çš„å¶æ•°ï¼Œä½œä¸ºåŒä¸€ç»„é¡µé¢çš„ç¬¬ä¸€ä¸ªé¡µé¢ prev
  41   2                  å¾—åˆ°çš„å¶æ•° + 1ï¼Œä½œä¸ºåŒä¸€ç»„é¡µé¢çš„ç¬¬äºŒä¸ªé¡µé¢ next
  42   2              */
  43   2              page_id += 1;
  44   2          }
  45   1          else
  46   1          {
  47   2              /*
  48   2                  å¦‚æœæ˜¯å¥‡æ•°é¡µé¢idï¼Œ
  49   2                  å¾—åˆ°çš„å¥‡æ•° - 1ï¼Œä½œä¸ºåŒä¸€ç»„é¡µé¢çš„ç¬¬ä¸€ä¸ªé¡µé¢ prev
  50   2                  å¾—åˆ°çš„å¥‡æ•°ï¼Œä½œä¸ºåŒä¸€ç»„é¡µé¢çš„ç¬¬äºŒä¸ªé¡µé¢ next
  51   2              */
  52   2              page_id -= 1;
C51 COMPILER V9.60.7.0   FUN_INFO                                                          08/15/2025 17:30:45 PAGE 2   

  53   2          }
  54   1      
  55   1          eeprom_24cxx_read(page_id, (u8 *)&eeprom_saveinfo, sizeof(eeprom_saveinfo_t));
  56   1          if (eeprom_saveinfo.is_data_valid == EEPROM_DATA_VALID_VAL)
  57   1          {
  58   2              // å¦‚æœè¯¥é¡µé¢çš„æ•°æ®æœ‰æ•ˆï¼Œå°†æ•°æ®è¯»å‡º
  59   2              if (temp_total_mileage >= eeprom_saveinfo.total_mileage)
  60   2              {
  61   3              }
  62   2              else
  63   2              {
  64   3                  fun_info.save_info.total_mileage = eeprom_saveinfo.total_mileage;
  65   3                  fun_info.save_info.subtotal_mileage = eeprom_saveinfo.subtotal_mileage;
  66   3                  fun_info.save_info.subtotal_mileage_2 = eeprom_saveinfo.subtotal_mileage_2;
  67   3              }
  68   2          }
  69   1      
  70   1          /*
  71   1              è¿è¡Œåˆ°è¿™é‡Œï¼Œå¦‚æœä¸¤ä¸ªé¡µé¢çš„æ•°æ®éƒ½æ— æ•ˆ
  72   1              is_data_valid éƒ½ä¸ç­‰äº EEPROM_DATA_VALID_VALï¼Œ
  73   1              é‚£ä¹ˆ fun_info.save_info åº”è¯¥æ²¡æœ‰è¢«èµ‹å€¼ï¼Œéƒ½ä¸º0
  74   1          */
  75   1      }
  76          
  77          // ä¿å­˜ å­˜æ”¾äº†æ‰€æœ‰ä¿¡æ¯çš„ç»“æ„ä½“å˜é‡ï¼Œå†™å…¥flashä¸­
  78          void fun_info_save(void)
  79          {
  80   1          // DEBUG ï¼š
  81   1          // printf("eeprom save begin\n"); // æ‰“å°è¿™å¥è¯æ—¶ï¼Œå¯ä»¥è¯•è¯•çªç„¶æ–­ç”µï¼Œæµ‹è¯•eepromçªç„
             -¶æ–­ç”µåï¼Œä¼šä¸ä¼šå½±å“æ•´ä¸ªé‡Œç¨‹è®°å½•çš„æ•°æ®
  82   1          eeprom_data_save();
  83   1      
  84   1          // DEBUG ï¼š
  85   1          // printf("eeprom save\n");
  86   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    151    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     36       5
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
