C51 COMPILER V9.60.7.0   TMR1                                                              08/02/2025 16:49:13 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE TMR1
OBJECT MODULE PLACED IN .\Release\Objects\tmr1.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\..\Hardware\tmr1.c LARGE OPTIMIZE(9,SIZE) BROWSE ORDER INTVECTOR(0X00
                    -0C) INCDIR(..\..\Libraries\Include;..\..\User;..\..\User\lib;..\..\Hardware) INTERVAL(3) DEBUG OBJECTEXTEND PRINT(.\Rele
                    -ase\Listings\tmr1.lst) OBJECT(.\Release\Objects\tmr1.obj)

line level    source

   1          #include "tmr1.h"
   2          
   3          // #define TMR1_CNT_TIME 152 // 152 * 0.65625us çº¦ç­‰äº100us
   4          
   5          // å®šæ—¶å™¨å®šæ—¶å‘¨æœŸ (å•ä½:Hz)
   6          // å‘¨æœŸå€¼ = ç³»ç»Ÿæ—¶é’Ÿ / å®šæ—¶å™¨åˆ†é¢‘ / é¢‘ç‡ - 1
   7          #define TMR1_PERIOD (SYSCLK / 128 / 1000 - 1) // 1000Hz,1ms
   8          
   9          // volatile bit tmr1_flag = 0; // TMR1ä¸­æ–­æœåŠ¡å‡½æ•°ä¸­ä¼šç½®ä½çš„æ ‡å¿—ä½
  10          volatile u32 tmr1_cnt = 0; // å®šæ—¶å™¨TMR1çš„è®¡æ•°å€¼ï¼ˆæ¯æ¬¡åœ¨ä¸­æ–­æœåŠ¡å‡½æ•°ä¸­ä¼šåŠ ä¸€ï¼‰
  11          
  12          /**
  13           * @brief é…ç½®å®šæ—¶å™¨TMR1ï¼Œé…ç½®å®Œæˆåï¼Œå®šæ—¶å™¨é»˜è®¤å…³é—­
  14           */
  15          void tmr1_config(void)
  16          {
  17   1          __SetIRQnIP(TMR1_IRQn, TMR1_IQn_CFG); // è®¾ç½®ä¸­æ–­ä¼˜å…ˆçº§ï¼ˆTMR1ï¼‰
  18   1          __DisableIRQ(TMR1_IRQn);              // ç¦ç”¨ä¸­æ–­
  19   1          IE_EA = 1;                            // æ‰“å¼€æ€»ä¸­æ–­
  20   1      
  21   1          TMR_ALLCON = TMR1_CNT_CLR(0x1); // æ¸…é™¤è®¡æ•°å€¼
  22   1      
  23   1          TMR1_CONL &= ~TMR_PRESCALE_SEL(0x07); // æ¸…é™¤TMR1çš„é¢„åˆ†é¢‘é…ç½®å¯„å­˜å™¨
  24   1          TMR1_CONL |= TMR_PRESCALE_SEL(0x07);  // å®šæ—¶å™¨é¢„åˆ†é¢‘
  25   1          TMR1_CONL &= ~TMR_MODE_SEL(0x03);     // æ¸…é™¤TMR1çš„æ¨¡å¼é…ç½®å¯„å­˜å™¨
  26   1          TMR1_CONL |= TMR_MODE_SEL(0x01);      // é…ç½®TMR1çš„æ¨¡å¼ä¸ºè®¡æ•°å™¨æ¨¡å¼ï¼Œæœ€åå¯¹ç³»ç»Ÿæ—¶é’Ÿ
             -çš„è„‰å†²è¿›è¡Œè®¡æ•°
  27   1      
  28   1          TMR1_CONH &= ~TMR_PRD_PND(0x01); // æ¸…é™¤TMR1çš„è®¡æ•°æ ‡å¿—ä½ï¼Œè¡¨ç¤ºæœªå®Œæˆè®¡æ•°
  29   1          TMR1_CONH |= TMR_PRD_IRQ_EN(1);  // ä½¿èƒ½TMR1çš„è®¡æ•°ä¸­æ–­
  30   1      
  31   1          // é…ç½®TMR1çš„è®¡æ•°å‘¨æœŸ
  32   1          TMR1_PRH = TMR_PERIOD_VAL_H((TMR1_PERIOD >> 8) & 0xFF); // å‘¨æœŸå€¼
  33   1          TMR1_PRL = TMR_PERIOD_VAL_L((TMR1_PERIOD >> 0) & 0xFF);
  34   1      
  35   1          // TMR1_CONL &= ~(TMR_SOURCE_SEL(0x07)); // æ¸…é™¤TMR1çš„æ—¶é’Ÿæºé…ç½®å¯„å­˜å™¨
  36   1          // TMR1_CONL |= TMR_SOURCE_SEL(0x05);    // é…ç½®TMR1çš„æ—¶é’Ÿæºï¼Œä¸ç”¨ä»»ä½•æ—¶é’Ÿ
  37   1      
  38   1          // é‡æ–°ç»™TMR1é…ç½®æ—¶é’Ÿ
  39   1          TMR1_CONL &= ~(TMR_SOURCE_SEL(0x07)); // æ¸…é™¤å®šæ—¶å™¨çš„æ—¶é’Ÿæºé…ç½®å¯„å­˜å™¨
  40   1          TMR1_CONL |= TMR_SOURCE_SEL(0x06);    // é…ç½®å®šæ—¶å™¨çš„æ—¶é’Ÿæºï¼Œä½¿ç”¨ç³»ç»Ÿæ—¶é’Ÿ
  41   1      
  42   1          __EnableIRQ(TMR1_IRQn); // ä½¿èƒ½ä¸­æ–­
  43   1          IE_EA = 1;              // æ‰“å¼€æ€»ä¸­æ–­
  44   1      }
  45          
  46          #if 0
              /**
               * @brief å¼€å¯å®šæ—¶å™¨TMR1ï¼Œå¼€å§‹è®¡æ—¶
               */
              void tmr1_enable(void)
              {
                  // é‡æ–°ç»™TMR1é…ç½®æ—¶é’Ÿ
C51 COMPILER V9.60.7.0   TMR1                                                              08/02/2025 16:49:13 PAGE 2   

                  TMR1_CONL &= ~(TMR_SOURCE_SEL(0x07)); // æ¸…é™¤å®šæ—¶å™¨çš„æ—¶é’Ÿæºé…ç½®å¯„å­˜å™¨
                  TMR1_CONL |= TMR_SOURCE_SEL(0x06);    // é…ç½®å®šæ—¶å™¨çš„æ—¶é’Ÿæºï¼Œä½¿ç”¨ç³»ç»Ÿæ—¶é’Ÿ
              
                  __EnableIRQ(TMR1_IRQn); // ä½¿èƒ½ä¸­æ–­
                  IE_EA = 1;              // æ‰“å¼€æ€»ä¸­æ–­
              }
              #endif
  60          
  61          #if 0  // void tmr1_disable(void)
              /**
               * @brief å…³é—­å®šæ—¶å™¨ï¼Œæ¸…ç©ºè®¡æ•°å€¼
               */
              void tmr1_disable(void)
              {
                  // ä¸ç»™å®šæ—¶å™¨æä¾›æ—¶é’Ÿï¼Œè®©å®ƒåœæ­¢è®¡æ•°
                  TMR1_CONL &= ~(TMR_SOURCE_SEL(0x07)); // æ¸…é™¤å®šæ—¶å™¨çš„æ—¶é’Ÿæºé…ç½®å¯„å­˜å™¨
                  TMR1_CONL |= TMR_SOURCE_SEL(0x05);    // é…ç½®å®šæ—¶å™¨çš„æ—¶é’Ÿæºï¼Œä¸ç”¨ä»»ä½•æ—¶é’Ÿ
              
                  TMR_ALLCON = TMR1_CNT_CLR(0x1); // æ¸…é™¤è®¡æ•°å€¼
              
                  __DisableIRQ(TMR1_IRQn); // å…³é—­ä¸­æ–­ï¼ˆä¸ä½¿èƒ½ä¸­æ–­ï¼‰
              }
              #endif // void tmr1_disable(void)
  76          
  77          #if 0
              void heart_beat_handle(void)
              {
                  static volatile u32 old_time_ms_cnt = 0; //
                  volatile u32 cur_time_ms_cnt = tmr1_cnt; // å…ˆè¯»å‡ºè®¡æ—¶,é˜²æ­¢è¢«ä¸­æ–­æ‰“æ–­
                  volatile u32 diff_ms_cnt = 0;
                  tmr1_cnt = 0;                                    // è¯»å‡ºè®¡æ—¶å,ç«‹åˆ»æ¸…é™¤å®šæ—¶å™¨çš„è®¡æ—¶
                  diff_ms_cnt = cur_time_ms_cnt - old_time_ms_cnt; // è®¡ç®—æ—¶é—´å·®
                  old_time_ms_cnt = 0;
              
              #if 0
              
                  // if (engine_scan_time_cnt < 65535 - diff_ms_cnt) // é˜²æ­¢è®¡æ•°æº¢å‡º
                  // {
                  //     // engine_scan_time_cnt++;
                  //     engine_scan_time_cnt += diff_ms_cnt;
                  //     if (engine_scan_time_cnt >= ENGINE_SPEED_SCAN_TIME_MS) // å¦‚æœå·²ç»åˆ°äº†ç´¯è®¡çš„æ—¶é—´
                  //     {
                  //         engine_actual_scan_time_cnt = engine_scan_time_cnt; // æ›´æ–°å®é™…çš„æ‰«ææ£€æµ‹æ—¶é—´
                  //         engine_scan_time_cnt = 0;
                  //         // detect_engine_pulse_cnt[1] += detect_engine_pulse_cnt[0]; // å°†å¦ä¸€ä¸ªå®šæ—¶å™¨ä¸­æ–­
             -æ‰«æåˆ°çš„è„‰å†²æ›´æ–°åˆ°[1]
                  //         // ä¸èƒ½åœ¨å®šæ—¶å™¨ä¸­æ–­å†…ç´¯åŠ è„‰å†²è®¡æ•°ï¼Œä¸»å¾ªç¯æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œç›¸å…³çš„è
             -®¡æ•°å‡½æ•°å°±ä¸èƒ½å®šæœŸå–åˆ°è¿™ä¸ªå€¼ï¼Œ
                  //         // ä¼šå½±å“è®¡ç®—ç»“æœï¼Œå¯èƒ½å¤šåŠ äº†å‡ ä¸ªè„‰å†²è®¡æ•°
                  //         // ä¸‹é¢ç›´æ¥è®©æ•°æ®è¦†ç›–ï¼Œå¦‚æœè®¡ç®—å‡½æ•°æ²¡æœ‰åŠæ—¶å–åˆ°æ•°å€¼ï¼Œä¹Ÿä¸å½±å“è
             -®¡ç®—ç»“æœ
                  //         detect_engine_pulse_cnt[1] = detect_engine_pulse_cnt[0]; // å°†å¦ä¸€ä¸ªå®šæ—¶å™¨ä¸­æ–­æ‰«æ
             -åˆ°çš„è„‰å†²æ›´æ–°åˆ°[1]
                  //         detect_engine_pulse_cnt[0] = 0;
                  //         flag_is_update_engine_pulse_cnt = 1; // è¡¨ç¤ºæœ‰æ•°æ®æ›´æ–°
                  //     }
                  // }
              
                  // if (speed_scan_time_cnt < 65535 - diff_ms_cnt) // é˜²æ­¢è®¡æ•°æº¢å‡º
                  // {
                  //     // speed_scan_time_cnt++;
                  //     speed_scan_time_cnt += diff_ms_cnt;
C51 COMPILER V9.60.7.0   TMR1                                                              08/02/2025 16:49:13 PAGE 3   

                  //     if (speed_scan_time_cnt >= SPEED_SCAN_TIME_MS) // å¦‚æœç»è¿‡äº† xx ms
                  //     {
                  //         speed_actual_scan_time_cnt = speed_scan_time_cnt; // æ›´æ–°å®é™…çš„æ‰«ææ£€æµ‹æ—¶é—´
                  //         speed_scan_time_cnt = 0;
                  //         // detect_speed_pulse_cnt[1] += detect_speed_pulse_cnt[0]; // å°†å¦ä¸€ä¸ªå®šæ—¶å™¨ä¸­æ–­æ‰
             -«æåˆ°çš„è„‰å†²æ›´æ–°åˆ°[1]
                  //         // ä¸èƒ½åœ¨å®šæ—¶å™¨ä¸­æ–­å†…ç´¯åŠ è„‰å†²è®¡æ•°ï¼Œä¸»å¾ªç¯æ‰§è¡Œæ—¶é—´è¿‡é•¿ï¼Œç›¸å…³çš„è
             -®¡æ•°å‡½æ•°å°±ä¸èƒ½å®šæœŸå–åˆ°è¿™ä¸ªå€¼ï¼Œ
                  //         // ä¼šå½±å“è®¡ç®—ç»“æœï¼Œå¯èƒ½å¤šåŠ äº†å‡ ä¸ªè„‰å†²è®¡æ•°
                  //         // ä¸‹é¢ç›´æ¥è®©æ•°æ®è¦†ç›–ï¼Œå¦‚æœè®¡ç®—å‡½æ•°æ²¡æœ‰åŠæ—¶å–åˆ°æ•°å€¼ï¼Œä¹Ÿä¸å½±å“è
             -®¡ç®—ç»“æœ
                  //         detect_speed_pulse_cnt[1] = detect_speed_pulse_cnt[0]; // å°†å¦ä¸€ä¸ªå®šæ—¶å™¨ä¸­æ–­æ‰«æ
             -åˆ°çš„è„‰å†²æ›´æ–°åˆ°[1]
                  //         detect_speed_pulse_cnt[0] = 0;                         //
                  //         flag_is_update_speed_pulse_cnt = 1;                    // è¡¨ç¤ºæœ‰æ•°æ®æ›´æ–°
                  //     } 
                  // }
              
              #endif
              
                  // if (mileage_save_time_cnt < 4294967295 - diff_ms_cnt) // é˜²æ­¢è®¡æ•°æº¢å‡º
                  {
                      // mileage_save_time_cnt++;
                      mileage_save_time_cnt += diff_ms_cnt;
                  }
              
                  // if (fuel_capacity_scan_cnt < 4294967295 - diff_ms_cnt) // é˜²æ­¢è®¡æ•°æº¢å‡º
                  {
                      // fuel_capacity_scan_cnt++;
                      fuel_capacity_scan_cnt += diff_ms_cnt;
                  }
              
                  // if (synchronous_request_status == SYN_REQUEST_STATUS_HANDLING)
                  {
                      // synchronous_request_time_cnt++; // åŒæ­¥è¯·æ±‚çš„å†·å´è®¡æ—¶
                      synchronous_request_time_cnt += diff_ms_cnt; // åŒæ­¥è¯·æ±‚çš„å†·å´è®¡æ—¶
                      if (synchronous_request_time_cnt >= 2000)
                      {
                          // å¦‚æœæ¥æ”¶åŒæ­¥è¯·æ±‚å·²ç»è¿‡äº† xx sï¼Œæ¸…é™¤å†·å´çŠ¶æ€
                          synchronous_request_time_cnt = 0;
                          synchronous_request_status = SYN_REQUEST_STATUS_NONE;
                      }
                  }
              
              #if 0 // æ—¥æœŸå’Œæ—¶é—´åˆåˆ°äº†ä¸€èµ·ï¼Œå°±ä¸ç”¨è¿™éƒ¨åˆ†ç¨‹åº
                  if (update_date_status == UPDATE_STATUS_HANDLING)
                  {
                      // å¦‚æœæ›´æ–°æ—¥æœŸè¿›å…¥å†·å´çŠ¶æ€ï¼Œè¿›è¡Œå†·å´è®¡æ—¶
                      // update_date_cooling_cnt++;
                      update_date_cooling_cnt += diff_ms_cnt;
                      if (update_date_cooling_cnt >= 100) // xx ms
                      {
                          // è¿‡äº†å†·å´æ—¶é—´ï¼Œé€€å‡ºå†·å´çŠ¶æ€
                          update_date_cooling_cnt = 0;
                          update_date_status = UPDATE_STATUS_NONE;
                      }
                  }
              #endif
              
                  // if (update_time_status == UPDATE_STATUS_HANDLING)
                  {
                      // å¦‚æœæ›´æ–°æ—¶é—´è¿›å…¥å†·å´çŠ¶æ€ï¼Œè¿›è¡Œå†·å´è®¡æ—¶
C51 COMPILER V9.60.7.0   TMR1                                                              08/02/2025 16:49:13 PAGE 4   

                      // update_time_cooling_cnt++;
                      update_time_cooling_cnt += diff_ms_cnt;
                      if (update_time_cooling_cnt >= 100) // xx ms
                      {
                          // è¿‡äº†å†·å´æ—¶é—´ï¼Œé€€å‡ºå†·å´çŠ¶æ€
                          update_time_cooling_cnt = 0;
                          update_time_status = UPDATE_STATUS_NONE;
                      }
                  }
              
                  // if (mileage_update_time_cnt < 65535)
                  {
                      mileage_update_time_cnt++;
                  }
              
                  // if (battery_scan_time_cnt < 4294967295)
                  {
                      battery_scan_time_cnt++;
                  }
              }
              #endif
 190          
 191          // TMR1ä¸­æ–­æœåŠ¡å‡½æ•°
 192          void TIMR1_IRQHandler(void) interrupt TMR1_IRQn
 193          {
 194   1          // è¿›å…¥ä¸­æ–­è®¾ç½®IPï¼Œä¸å¯åˆ é™¤
 195   1          __IRQnIPnPush(TMR1_IRQn);
 196   1      
 197   1          /*
 198   1              æµ‹è¯•ä¸­æ–­æŒç»­æ—¶é—´
 199   1              å†…éƒ¨æœªè°ƒç”¨å‡½æ•°ï¼Œçº¦           74.5us,
 200   1              è°ƒç”¨engine_speed_scan()æ—¶çº¦ 200us,
 201   1              è°ƒç”¨speed_scan()æ—¶çº¦        271us,
 202   1              ä¸¤ä¸ªä¸€èµ·è°ƒç”¨ï¼Œçº¦             426us,
 203   1      
 204   1              å°† engine_speed_scan()å’Œspeed_scan()æ”¾åˆ°ä¸»å‡½æ•°æ¥è®¡ç®—ï¼Œ
 205   1              æœ€çŸ­ç”¨æ—¶çº¦ 43usï¼Œ
 206   1              ç›¸ç»§æ‰§è¡Œäº†engine_speed_scanå’Œspeed_scanå¯¹åº”çš„æ¡ä»¶ï¼Œè¿›è¡Œæ›´æ–°æ—¶ï¼Œçº¦ 75us
 207   1      
 208   1              å°† å¯¹å…¶ä»–åŠŸèƒ½çš„æ—¶é—´è¿›è¡Œè®¡æ•°çš„æ“ä½œå…¨éƒ¨è½¬ç§»åˆ°å¤–éƒ¨å‡½æ•°,åªåœ¨è¯¥ä¸­æ–­å¯¹ tm
             -r1_cnt åŠ ä¸€,
 209   1              çº¦ 5us
 210   1          */
 211   1          // P20 = 1;
 212   1      
 213   1          // ---------------- ç”¨æˆ·å‡½æ•°å¤„ç† -------------------
 214   1      
 215   1          // å‘¨æœŸä¸­æ–­
 216   1          if (TMR1_CONH & TMR_PRD_PND(0x1))
 217   1          {
 218   2              TMR1_CONH |= TMR_PRD_PND(0x1); // æ¸…é™¤pending
 219   2      
 220   2              if (tmr1_cnt < 4294967295)
 221   2              {
 222   3                  tmr1_cnt++;
 223   3              }
 224   2      
 225   2              {
 226   3                  // static u8 cnt = 0;
 227   3                  // cnt++;
 228   3                  // if (cnt >= TOUCH_KEY_SCAN_CIRCLE_TIMES) // xx ms
 229   3                  // {
C51 COMPILER V9.60.7.0   TMR1                                                              08/02/2025 16:49:13 PAGE 5   

 230   3                  //     cnt = 0;
 231   3                  //     // flag_is_touch_key_scan_circle_arrived = 1; // è¡¨ç¤ºæ‰«æå‘¨æœŸåˆ°æ¥ï¼Œæ‰§è¡Œä¸€æ¬
             -¡æŒ‰é”®æ‰«æ
 232   3      
 233   3                  //     // {
 234   3                  //     //     static u8 send_cnt = 0;
 235   3                  //     //     send_cnt++;
 236   3                  //     //     if (send_cnt >= 100)
 237   3                  //     //     {
 238   3                  //     //         send_cnt = 0;
 239   3                  //     //         printf("touch key scan\n");
 240   3                  //     //     }
 241   3                  //     // }
 242   3                  // }
 243   3      
 244   3      #if AD_KEY_ENABLE
 245   3                  // åœ¨å®šæ—¶å™¨æ³¨å†ŒæŒ‰é”®æ‰«æï¼š
 246   3                  if (ad_key_para.cur_scan_times < 255)
 247   3                  {
 248   4                      ad_key_para.cur_scan_times++;
 249   4                  }
 250   3      #endif // AD_KEY_ENABLE
 251   3      
 252   3      #if TOUCH_KEY_ENABLE
 253   3                  if (touch_key_para.cur_scan_times < 255)
 254   3                  {
 255   4                      touch_key_para.cur_scan_times++;
 256   4                  }
 257   3      #endif // TOUCH_KEY_ENABLE
 258   3      
 259   3      #if PIN_LEVEL_SCAN_ENABLE
 260   3                  if (pin_level_scan_time_cnt < 65535) // é˜²æ­¢è®¡æ•°æº¢å‡º
 261   3                  {
 262   4                      pin_level_scan_time_cnt++;
 263   4                  }
 264   3      #endif
 265   3      
 266   3      #if FUEL_CAPACITY_SCAN_ENABLE
 267   3                  if (flag_timer_scan_update_fuel_gear)
 268   3                  {
 269   4                      if (timer_scan_update_fuel_gear_cnt < 65535)
 270   4                      {
 271   5                          timer_scan_update_fuel_gear_cnt++;
 272   5                          if (timer_scan_update_fuel_gear_cnt >= FUEL_UPDATE_LAST_FUEL_PERCENTAGE_TIME)
 273   5                          // if (timer_scan_update_fuel_gear_cnt >= 5000) // DEBUG æµ‹è¯•ç”¨
 274   5                          {
 275   6                              timer_scan_update_fuel_gear_cnt = 0;
 276   6                              flag_update_fuel_gear = 1; // æ›´æ–°æ²¹é‡æŒ¡ä½
 277   6                          }
 278   5                      }
 279   4                  }
 280   3                  else
 281   3                  {
 282   4                      timer_scan_update_fuel_gear_cnt = 0;
 283   4                      flag_update_fuel_gear = 0;
 284   4                  }
 285   3      #endif
 286   3      
 287   3      #if SPEED_SCAN_ENABLE
 288   3                  {
 289   4                      static u16 cnt = 0;
 290   4                      cnt++;
C51 COMPILER V9.60.7.0   TMR1                                                              08/02/2025 16:49:13 PAGE 6   

 291   4                      if (cnt >= SPEED_SCAN_BUFF_UPDATE_TIME)
 292   4                      {
 293   5                          cnt = 0;
 294   5                          flag_is_send_speed_time_come = 1;
 295   5                      }
 296   4                  }
 297   3      #endif
 298   3      
 299   3      #if ENGINE_SPEED_SCAN_ENABLE
 300   3                  {
 301   4                      static u16 cnt = 0;
 302   4                      cnt++;
 303   4                      if (cnt >= ENGINE_SPEED_SEND_PERIOD)
 304   4                      {
 305   5                          cnt = 0;
 306   5                          flag_is_send_engine_speed_time_come = 1;
 307   5                      }
 308   4                  }
 309   3      #endif
 310   3      
 311   3                  // if (mileage_save_time_cnt < 4294967295 - diff_ms_cnt) // é˜²æ­¢è®¡æ•°æº¢å‡º
 312   3                  {
 313   4                      mileage_save_time_cnt++;
 314   4                      // mileage_save_time_cnt += diff_ms_cnt;
 315   4                  }
 316   3      
 317   3      #if FUEL_CAPACITY_SCAN_ENABLE
 318   3                  // if (fuel_capacity_scan_cnt < 4294967295 - diff_ms_cnt) // é˜²æ­¢è®¡æ•°æº¢å‡º
 319   3                  {
 320   4                      fuel_capacity_scan_cnt++;
 321   4                      // fuel_capacity_scan_cnt += diff_ms_cnt;
 322   4                  }
 323   3      #endif
 324   3      
 325   3                  // if (synchronous_request_status == SYN_REQUEST_STATUS_HANDLING)
 326   3                  {
 327   4                      synchronous_request_time_cnt++; // åŒæ­¥è¯·æ±‚çš„å†·å´è®¡æ—¶
 328   4                      // synchronous_request_time_cnt += diff_ms_cnt; // åŒæ­¥è¯·æ±‚çš„å†·å´è®¡æ—¶
 329   4                      if (synchronous_request_time_cnt >= 2000)
 330   4                      {
 331   5                          // å¦‚æœæ¥æ”¶åŒæ­¥è¯·æ±‚å·²ç»è¿‡äº† xx sï¼Œæ¸…é™¤å†·å´çŠ¶æ€
 332   5                          synchronous_request_time_cnt = 0;
 333   5                          synchronous_request_status = SYN_REQUEST_STATUS_NONE;
 334   5                      }
 335   4                  }
 336   3      
 337   3      #if 0 // æ—¥æœŸå’Œæ—¶é—´åˆåˆ°äº†ä¸€èµ·ï¼Œå°±ä¸ç”¨è¿™éƒ¨åˆ†ç¨‹åº
                  if (update_date_status == UPDATE_STATUS_HANDLING)
                  {
                      // å¦‚æœæ›´æ–°æ—¥æœŸè¿›å…¥å†·å´çŠ¶æ€ï¼Œè¿›è¡Œå†·å´è®¡æ—¶
                      // update_date_cooling_cnt++;
                      update_date_cooling_cnt += diff_ms_cnt;
                      if (update_date_cooling_cnt >= 100) // xx ms
                      {
                          // è¿‡äº†å†·å´æ—¶é—´ï¼Œé€€å‡ºå†·å´çŠ¶æ€
                          update_date_cooling_cnt = 0;
                          update_date_status = UPDATE_STATUS_NONE;
                      }
                  }
              #endif
 351   3      
 352   3                  // if (update_time_status == UPDATE_STATUS_HANDLING)
C51 COMPILER V9.60.7.0   TMR1                                                              08/02/2025 16:49:13 PAGE 7   

 353   3                  {
 354   4                      // å¦‚æœæ›´æ–°æ—¶é—´è¿›å…¥å†·å´çŠ¶æ€ï¼Œè¿›è¡Œå†·å´è®¡æ—¶
 355   4                      update_time_cooling_cnt++;
 356   4                      // update_time_cooling_cnt += diff_ms_cnt;
 357   4                      if (update_time_cooling_cnt >= 100) // xx ms
 358   4                      {
 359   5                          // è¿‡äº†å†·å´æ—¶é—´ï¼Œé€€å‡ºå†·å´çŠ¶æ€
 360   5                          update_time_cooling_cnt = 0;
 361   5                          update_time_status = UPDATE_STATUS_NONE;
 362   5                      }
 363   4                  }
 364   3      
 365   3                  // if (mileage_update_time_cnt < 65535)
 366   3                  {
 367   4                      mileage_update_time_cnt++;
 368   4                  }
 369   3      
 370   3      #if BATTERY_SCAN_ENABLE
 371   3                  // if (battery_scan_time_cnt < 4294967295)
 372   3                  {
 373   4                      battery_scan_time_cnt++;
 374   4                  }
 375   3      #endif // BATTERY_SCAN_ENABLE
 376   3      
 377   3      #if 0 // DEBUG åªåœ¨æµ‹è¯•æ—¶ä½¿ç”¨
              
                          {
                              static u16 cnt;
                              cnt++;
                              if (cnt >= 1000)
                              {
                                  cnt = 0;
                                  flag_is_debug_update = 1;
                              }
                          }
              
              #endif // // DEBUG åªåœ¨æµ‹è¯•æ—¶ä½¿ç”¨
 390   3      
 391   3                  {
 392   4                      static u16 cnt;
 393   4                      cnt++;
 394   4                      if (cnt >= 2000)
 395   4                      {
 396   5                          cnt = 0;
 397   5                          flag_debug_is_send_time = 1; // å‘é€æ—¶é—´
 398   5                      }
 399   4                  }
 400   3              }
 401   2          }
 402   1      
 403   1          // P20 = 0;// æµ‹è¯•ä¸­æ–­æŒç»­æ—¶é—´
 404   1          // é€€å‡ºä¸­æ–­è®¾ç½®IPï¼Œä¸å¯åˆ é™¤
 405   1          __IRQnIPnPop(TMR1_IRQn);
 406   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    493    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     10    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
C51 COMPILER V9.60.7.0   TMR1                                                              08/02/2025 16:49:13 PAGE 8   

   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
